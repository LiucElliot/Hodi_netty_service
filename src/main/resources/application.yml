# ==================== 应用基础配置 ====================
spring:
  application:
    name: hodi-meter-server
  profiles:
    active: dev
  main:
    banner-mode: console
    allow-bean-definition-overriding: true

# ==================== 服务器配置 ====================
server:
  port: 8080
  servlet:
    context-path: /api
  compression:
    enabled: true
    mime-types: text/html,text/xml,text/plain,text/css,text/javascript,application/javascript,application/json
    min-response-size: 1024

# ==================== Netty 服务器配置 ====================
netty:
  server:
    # 主服务器配置
    main:
      port: 9090
      boss-threads: 1
      worker-threads: 4
      backlog: 1024
      keep-alive: true
      reuse-address: true
      tcp-no-delay: true
      so-keep-alive: true
      so-backlog: 1024
      connect-timeout: 30000
      read-timeout: 60000
      write-timeout: 60000
    
    # 子服务器配置（可选）
    sub:
      port: 9091
      boss-threads: 1
      worker-threads: 2
      backlog: 512
    
    # 连接池配置
    connection-pool:
      max-connections: 10000
      max-idle-time: 300000
      connection-timeout: 30000
    
    # 心跳配置
    heartbeat:
      enabled: true
      interval: 30000
      timeout: 90000
    
    # 协议配置
    protocol:
      max-frame-length: 65536
      max-message-length: 1048576
      enable-compression: false

# ==================== 监控和运维配置 ====================
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus,env,configprops
      base-path: /actuator
  endpoint:
    health:
      show-details: when-authorized
      show-components: always
    metrics:
      enabled: true
    prometheus:
      enabled: true
  metrics:
    tags:
      application: ${spring.application.name}
      environment: ${spring.profiles.active}
  health:
    defaults:
      enabled: true
    netty:
      enabled: true
      timeout: 5000
  prometheus:
    metrics:
      export:
        enabled: true

# ==================== 日志配置 ====================
logging:
  level:
    root: INFO
    com.hodi.liuc: DEBUG
    io.netty: INFO
    org.springframework: INFO
    org.springframework.boot.autoconfigure: WARN
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n"
  file:
    name: logs/hodi-meter-server.log
    max-size: 100MB
    max-history: 30
  logback:
    rolling policy:
      max-file-size: 100MB
      max-history: 30
      total-size-cap: 3GB

# ==================== 应用自定义配置 ====================
#app:
#  # 业务配置
#  business:
#    # 设备管理
#    device:
#      max-devices: 10000
#      heartbeat-interval: 30000
#      offline-timeout: 300000
#
#    # 数据采集
#    data-collection:
#      batch-size: 100
#      flush-interval: 5000
#      retry-times: 3
#      retry-interval: 1000
#
#    # 缓存配置
#    cache:
#      enabled: true
#      ttl: 3600
#      max-size: 10000
#
#  # 安全配置
#  security:
#    enabled: true
#    jwt:
#      secret: your-jwt-secret-key-here
#      expiration: 86400000
#    rate-limit:
#      enabled: true
#      max-requests: 1000
#      time-window: 60000

# ==================== 数据库配置（如果需要） ====================
# spring:
#   datasource:
#     url: jdbc:mysql://localhost:3306/hodi_meter?useSSL=false&serverTimezone=UTC
#     username: root
#     password: password
#     driver-class-name: com.mysql.cj.jdbc.Driver
#     hikari:
#       maximum-pool-size: 20
#       minimum-idle: 5
#       connection-timeout: 30000
#       idle-timeout: 600000
#       max-lifetime: 1800000

# ==================== Redis配置（如果需要） ====================
# spring:
#   redis:
#     host: localhost
#     port: 6379
#     password: 
#     database: 0
#     timeout: 3000
#     lettuce:
#       pool:
#         max-active: 20
#         max-idle: 10
#         min-idle: 5
#         max-wait: 3000